
## 이미지로 컨테이너 만들기

- 이미지를 이용해서 컨테이너를 만든다.
- 이미지는 프로그램을 실행하는데 필요한 설정이나 종속성들을 가지고 있다.

- 이미지는 응용프로그램을 실행하는데 필요한 모든것을 포함하고 있다.

- 이미지
    - 시작시 실행될 명령어
        - run kakaotalk
    - 파일 스냅샷
        - 카카오톡 파일
        
    
- 이미지를 이용해서 컨테이너를 만든다.
- 컨테이너 자체가 프로그램이 실행되는것이 아니다.
- 컨테이너가 시작될때 실행할 명령어가 필요하다

- 파일 스냅샷은 디렉토리나 파일을 카피한것

- 이미지로 컨테이너 만드는 순서
    - Docker클라이언트에 docker run <Image> 입력해줍니다.
    - 도커 이미지에 있는 파일 스냅샷을 컨테이너 하드디스크에 옮겨줍니다.
    - 이미지에서 가지고 있는 명령어(컨테이너가 실행횔때 사용될 명령어를)이용해서
    카카오톡을 실행시켜 줍니다.
    
- Cgroup, 네임스페이스를 쓸수 있는이유
    - 컨테이너를 격리 시킬수 있는 이유는 Cgroup과 네임스페이스를 사용해서 이다.
    - 하지만 생각해보면 리눅스 환경에서만 사용된다.
- Cgroup과 네임스페이스는 Linux에서만 사용이 가능하다.
    - 나는 지금 윈도우나 맥OS를 사용하고 있다.
    - 어떻게 이것이 가능한가?
    - 터미널을 켠 후
    - docker version을 쳐보면 된다.
    - 도커 서버가 리눅스가 된다.
    

- 기본적인 도커 클라이언트 명령어 알아보기
    - docker 도커클라이언트 언급
    - run 컨테이너 생성및 실행
    - 이미지이름 이 컨테이너를 위한 이미지
    
- 작동 순서 복습
    - 도커 클라이언트에 명령어 입력후 도커 서버로 보냄
    - 도커 서버에서 컨테이너를 위한 이미지가 이미 캐쉬되어있는지 확인
    - 없으면 도커 허브에서 다운 받아옴 있다면 그 이미 가지고 있는 이미지로 컨테이너 생성
- 이미지로 컨테이너 생성하는 순서
    - 먼저 파일 스냅샷 되어있는것을 컨테이너의 하드 디스크 부분에 올린다
    - 시작 커맨드를 이용하여 어플리케이션을 실행

- docker run alpine ls
    - ls : 커맨드는 현재 디렉토리의 파일 리스트 표출
    - 4번째 자리는 원래 이미지가 가지고 있는 시작 명령어를 무시하고 여기에 있는 커맨드를 실행하게함
    
    
- alpine 이미지를 

- 이미지 이름 뒤에 다른 명령어를 더 붙여서 원래 이미지안에 있는 기본 커맨드는 무시가 되고 ls명령어가 실행됨
- alpine 이미지 파일 스냅샷 안에 이미 ls를 사용 가능하게 하는 파일이 있다.

- hello-world이미지는 ls를 못한다.


- 컨테이너들 나열하기
    - 현재 실행중인 컨테이너 나열
        - docker : 도커 클라이언트 언급
        - ps : process status
        
- 실습
    - 2개의 터미널을 작동
    - 첫번째 터미널에서 컨테이너 하나를 실행
    - 두번째 터미널에 docker ps로 확인
    
- ps
    - Container ID : 컨테이너의 고유한 아이디 해쉬값.
    - IMAGE : 컨테이너 생성시 사용한 도커 이미지
    - COMMAND : 컨테이너 시작시 실행될 명령어, 대부분 이미지 내장되어 있으므로 별도의 설정이 필요없다
    - CREATED : 컨테이너가 생성된 시간
    - STATUS : UP : 실행중 Exited 종료 Pause 일시정지 
    - PORTS: 컨테이너가 개방한 포트와 호스트에 연결한 포트, 특별한 설정하지 않는 경우 출력되지 않는다.
    - NAMES: 컨테이너 고유한 이름 , 컨테이너 생성시 --name옵션으로 이름을 설정하지 않으면
    도커 엔진이 임의로 형용사와 명사를 조합해 설정 id와 마찬가지로 중복이 안되고 docker rename명령어로 이름을
    변경할 수 있다. docker rename original-name change-name
    
- 원하는 항몽만 보기
    -  docker ps --format 'table{{.Names}}\t table{{.Image}}'
    
- 도커 컨테이너의 생명주기
    - 생성
        - docker create <이미지 이름>
        - docker run <이미지 이름>
    - 시작
        - docker start <시작할 컨테이너 아이디/이름>
    - 실행
        - docker stop <중지할 컨테이너 아이디/ 이름>
    - 중지
        - docker rm <삭제할 컨테이너 아이디/이름>
    - 삭제
    


- docker run = docker crate + docker start( -a attach)
    - a없이하면 그냥 id만 나온다.
    - docker 컨테이너가 실행될때 붙어있다가 아웃풋들을 화면에 표출해준다.
    
- docker stop vs docker kill
    - 도커의 생명주기중에서 중지부분 docker stop과 docker kill로 중지할수 있다.

- stop
    - Gracefully하게 중지를 시킨다
    - 자비롭고 그동안 하던 작업들을 (메시지를 보내고 있었따면 보내고 있던 메시지)완료하고 컨테이너를 중지시킨다.
- kill
    - stop과 달리 어떠한 것도 기다리지 않고 바로 컨테이너를 중지시킨다.
- docker stop -> sigterm - (grace period) -> sigkill -> main Process (Container)
- docker kill -> sigkill -> main Process (Container)

- 컨테이너 삭제하기
    - docker rm <아이디/이름>
    - 실행중인 컨테이너는 먼저 중지한 후에 삭제가능하다.
- 모든 컨테이너를 삭제하고 싶다면?
    - docker rm 'docker ps -a -q'
- 이미지를 삭제하고 싶다면?
    - docker rmi <이미지 id>
    
- 한번에 컨테이너 이미지 네트워크 모두 삭제하고 싶다면?
    - docker system prune
    